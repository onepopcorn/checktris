(function(e){function i(){court=document.getElementById("court"),court.style.width=13*fieldWidth+"px",court.innerHTML="";for(var e=0;fieldWidth*fieldHeight>e;e++)court.innerHTML+='<input type="checkbox">';nextBox=document.getElementById("next"),nextBox.innerHTML="",nextBox.style.width="52px";for(var e=0;16>e;e++)nextBox.innerHTML+='<input type="checkbox">'}function t(e,i,t,n,c){var o,r=0,s=0,d=e[n];for(o=32768;o>0;o>>=1)d&o&&c(i+s,t+r),4===++s&&(s=0,r++)}function n(e,i,n,c){var o=!1;return t(e,i,n,c,function(e,i){(0>e||e>=fieldWidth||0>i||i>=fieldHeight||occupiedBlocks[e+i*fieldWidth])&&(o=!0)}),o}function c(){0==randomPiecesList.length&&(randomPiecesList=[pieces[0],pieces[0],pieces[0],pieces[0],pieces[1],pieces[1],pieces[1],pieces[1],pieces[2],pieces[2],pieces[2],pieces[2],pieces[3],pieces[3],pieces[3],pieces[3],pieces[4],pieces[4],pieces[4],pieces[4],pieces[5],pieces[5],pieces[5],pieces[5],pieces[6],pieces[6],pieces[6],pieces[6]]);var e=randomPiecesList.splice(Math.floor(Math.random()*randomPiecesList.length),1)[0];return{type:e,dir:R.UP,x:0,y:0}}function o(){piecesCount++;var e=c();p(),t(e.type,e.x,e.y,e.dir,function(e,i){v(nextBox,e,i,4)}),current=next,next=e,piecesCount==H&&(piecesCount=0,dropSpeed-=5)}function r(){t(current.type,current.x,current.y,current.dir,function(e,i){v(court,e,i,fieldWidth)}),timestamp>=dropSpeed?(timestamp=0,s()):timestamp++}function s(){!W(R.DOWN)&&current.y>0?(t(current.type,current.x,current.y,current.dir,function(e,i){occupiedBlocks[e+i*fieldWidth]=1}),o(),d()):0==current.y&&k()}function d(){for(var e=fieldHeight-1;e>0;e--){for(var i=0,t=0;fieldWidth>t;t++)occupiedBlocks[t+e*fieldWidth]!==void 0&&(i+=occupiedBlocks[t+e*fieldWidth]);i==fieldWidth&&linesToRemove.push(e)}linesToRemove.length&&(u(),a(linesToRemove.length))}function u(){B();for(var e=0;linesToRemove.length>e;e++)for(var i=0;fieldWidth>i;i++)h(court,i,linesToRemove[e],fieldWidth);setTimeout(l,300)}function l(){for(var e=linesToRemove.length,i=0;e>i;i++)for(var t=0;fieldWidth>t;t++)occupiedBlocks[t+linesToRemove[i]*fieldWidth]=null,m(court,t,linesToRemove[i],fieldWidth);for(var i=e;i>0;i--){console.log(i);for(var n=linesToRemove[i-1];n>0;n--)for(var t=0;fieldWidth>t;t++)occupiedBlocks[t+n*fieldWidth]&&(occupiedBlocks[t+n*fieldWidth]=null,m(court,t,n,fieldWidth),occupiedBlocks[t+(n+1)*fieldWidth]=1,v(court,t,n+1,fieldWidth))}linesToRemove=[],g()}function a(e){lines+=e,score+=E*e+10*(e-1),document.getElementById("score").innerHTML=score,document.getElementById("linesCounter").innerHTML=lines}function f(){t(current.type,current.x,current.y,current.dir,function(e,i){m(court,e,i,fieldWidth)})}function p(){for(var e=0;16>e;e++)nextBox.childNodes[e].className="",nextBox.childNodes[e].checked=!1}function h(e,i,t,n){e.childNodes[i+t*n].checked=!0}function m(e,i,t,n){e.childNodes[i+t*n].className="",e.childNodes[i+t*n].checked=!1}function v(e,i,t,n){e.childNodes[i+t*n].className="hide"}function y(e){switch(e.keyCode){case N.UP:actions.push(R.UP);break;case N.RIGHT:actions.push(R.RIGHT);break;case N.DOWN:actions.push(R.DOWN);break;case N.LEFT:actions.push(R.LEFT)}}function T(){var e=current.dir==R.MAX?R.MIN:current.dir+1;n(current.type,current.x,current.y,e)||(f(),current.dir=e)}function W(e){var i=current.x,t=current.y;switch(e){case R.LEFT:i--;break;case R.RIGHT:i++;break;case R.DOWN:t++}return n(current.type,i,t,current.dir)?!1:(f(),current.x=i,current.y=t,!0)}function x(e){e.target.removeEventListener("click",x),e.target.style.display="none",i(),o(),o(),L(),document.addEventListener("keydown",y)}function k(){B(),confirm("Play again?")&&location.reload()}function g(){animationID=e.requestAnimationFrame(L)}function B(){e.cancelAnimationFrame(animationID)}function L(){if(g(),actions.length)switch(actions.shift()){case R.UP:T();break;case R.LEFT:W(R.LEFT);break;case R.RIGHT:W(R.RIGHT);break;case R.DOWN:W(R.DOWN)}r()}var N={SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},R={UP:0,RIGHT:1,DOWN:2,LEFT:3,MIN:0,MAX:3},E=100,H=30;fieldWidth=10,fieldHeight=20,dropSpeed=50,lines=0,score=0,piecesCount=0,occupiedBlocks=[],actions=[],timestamp=0,randomPiecesList=[],linesToRemove=[],pieces=[[3840,8738,3840,8738],[17600,36352,25664,3616],[17504,3712,50240,11776],[1632,1632,1632,1632],[1728,35904,1728,35904],[3648,19520,19968,17984],[3168,19584,3168,19584]],e.onload=function(){document.getElementById("loading").style.display="none",document.getElementById("play-button").addEventListener("click",x,!1)}})(window);
//@ sourceMappingURL=chektris.js.map