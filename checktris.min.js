function drawCourt(){court=document.getElementById("court"),court.style.width=13*fieldWidth+"px",court.innerHTML="";for(var e=0;fieldWidth*fieldHeight>e;e++)court.innerHTML+='<input type="checkbox">';nextBox=document.getElementById("next"),nextBox.innerHTML="",nextBox.style.width="52px";for(var e=0;16>e;e++)nextBox.innerHTML+='<input type="checkbox">'}function eachblock(e,i,c,t,n){var o,r=0,d=0,s=e[t];for(o=32768;o>0;o>>=1)s&o&&n(i+d,c+r),4===++d&&(d=0,r++)}function collision(e,i,c,t){var n=!1;return eachblock(e,i,c,t,function(e,i){(0>e||e>=fieldWidth||0>i||i>=fieldHeight||occupiedBlocks[e+i*fieldWidth])&&(n=!0)}),n}function randomPiece(){0==randomPiecesList.length&&(randomPiecesList=[pieces[0],pieces[0],pieces[0],pieces[0],pieces[1],pieces[1],pieces[1],pieces[1],pieces[2],pieces[2],pieces[2],pieces[2],pieces[3],pieces[3],pieces[3],pieces[3],pieces[4],pieces[4],pieces[4],pieces[4],pieces[5],pieces[5],pieces[5],pieces[5],pieces[6],pieces[6],pieces[6],pieces[6]]);var e=randomPiecesList.splice(Math.floor(Math.random()*randomPiecesList.length),1)[0];return{type:e,dir:DIR.UP,x:0,y:0}}function drawNext(){piecesCount++;var e=randomPiece();clearNext(),eachblock(e.type,e.x,e.y,e.dir,function(e,i){drawBlock(nextBox,e,i,4)}),current=next,next=e,piecesCount==LEVEL_UP&&(piecesCount=0,dropSpeed-=5)}function render(){eachblock(current.type,current.x,current.y,current.dir,function(e,i){drawBlock(court,e,i,fieldWidth)}),timestamp>=dropSpeed?(timestamp=0,moveDown()):timestamp++}function moveDown(){!move(DIR.DOWN)&&current.y>0?(eachblock(current.type,current.x,current.y,current.dir,function(e,i){occupiedBlocks[e+i*fieldWidth]=1}),drawNext(),checkCompletedLines()):0==current.y&&gameOver()}function checkCompletedLines(){for(var e=fieldHeight-1;e>0;e--){for(var i=0,c=0;fieldWidth>c;c++)occupiedBlocks[c+e*fieldWidth]!==void 0&&(i+=occupiedBlocks[c+e*fieldWidth]);i==fieldWidth&&linesToRemove.push(e)}linesToRemove.length&&(markLines(),addScore(linesToRemove.length))}function markLines(){pause();for(var e=0;linesToRemove.length>e;e++)for(var i=0;fieldWidth>i;i++)highlightBlock(court,i,linesToRemove[e],fieldWidth);setTimeout(removeLines,300)}function removeLines(){for(var e=linesToRemove.length,i=0;e>i;i++)for(var c=0;fieldWidth>c;c++)occupiedBlocks[c+linesToRemove[i]*fieldWidth]=null,clearBlock(court,c,linesToRemove[i],fieldWidth);for(var i=e;i>0;i--){console.log(i);for(var t=linesToRemove[i-1];t>0;t--)for(var c=0;fieldWidth>c;c++)occupiedBlocks[c+t*fieldWidth]&&(occupiedBlocks[c+t*fieldWidth]=null,clearBlock(court,c,t,fieldWidth),occupiedBlocks[c+(t+1)*fieldWidth]=1,drawBlock(court,c,t+1,fieldWidth))}linesToRemove=[],resume()}function addScore(e){lines+=e,score+=POINTS_PER_LINE*e+10*(e-1),document.getElementById("score").innerHTML=score,document.getElementById("linesCounter").innerHTML=lines}function clearCourt(){eachblock(current.type,current.x,current.y,current.dir,function(e,i){clearBlock(court,e,i,fieldWidth)})}function clearNext(){for(var e=0;16>e;e++)nextBox.childNodes[e].className="",nextBox.childNodes[e].checked=!1}function highlightBlock(e,i,c,t){e.childNodes[i+c*t].checked=!0}function clearBlock(e,i,c,t){e.childNodes[i+c*t].className="",e.childNodes[i+c*t].checked=!1}function drawBlock(e,i,c,t){e.childNodes[i+c*t].className="hide"}function inputManager(e){switch(e.keyCode){case KEY.UP:actions.push(DIR.UP);break;case KEY.RIGHT:actions.push(DIR.RIGHT);break;case KEY.DOWN:actions.push(DIR.DOWN);break;case KEY.LEFT:actions.push(DIR.LEFT)}}function rotate(){var e=current.dir==DIR.MAX?DIR.MIN:current.dir+1;collision(current.type,current.x,current.y,e)||(clearCourt(),current.dir=e)}function move(e){var i=current.x,c=current.y;switch(e){case DIR.LEFT:i--;break;case DIR.RIGHT:i++;break;case DIR.DOWN:c++}return collision(current.type,i,c,current.dir)?!1:(clearCourt(),current.x=i,current.y=c,!0)}function play(e){e.target.removeEventListener("click",play),e.target.style.display="none",drawCourt(),drawNext(),drawNext(),update(),document.addEventListener("keydown",inputManager)}function gameOver(){pause(),confirm("Play again?")&&location.reload()}function resume(){animationID=window.requestAnimationFrame(update)}function pause(){window.cancelAnimationFrame(animationID)}function update(){if(resume(),actions.length)switch(actions.shift()){case DIR.UP:rotate();break;case DIR.LEFT:move(DIR.LEFT);break;case DIR.RIGHT:move(DIR.RIGHT);break;case DIR.DOWN:move(DIR.DOWN)}render()}var KEY={SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},DIR={UP:0,RIGHT:1,DOWN:2,LEFT:3,MIN:0,MAX:3},POINTS_PER_LINE=100,LEVEL_UP=30;fieldWidth=10,fieldHeight=20,dropSpeed=50,lines=0,score=0,piecesCount=0,occupiedBlocks=[],actions=[],timestamp=0,randomPiecesList=[],linesToRemove=[],pieces=[[3840,8738,3840,8738],[17600,36352,25664,3616],[17504,3712,50240,11776],[1632,1632,1632,1632],[1728,35904,1728,35904],[3648,19520,19968,17984],[3168,19584,3168,19584]],window.onload=function(){document.getElementById("loading").style.display="none",document.getElementById("play-button").addEventListener("click",play,!1)};
//@ sourceMappingURL=chektris.js.map